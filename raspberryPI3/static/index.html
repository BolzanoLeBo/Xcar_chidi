<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/eventemitter2@6.4.9/lib/eventemitter2.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>
</head>

<body>
  <h1>Contrôle de la voiture</h1>

  <!-- Boutons pour choisir le mode -->
  <button onclick="selectMode('manuel')">Mode Manuel</button>
  <button onclick="selectMode('autonome')">Mode Autonome</button>
  <button onclick="selectMode('tracking')">Mode Tracking</button>

  <!-- Div pour afficher les données du topic "state" -->
  <div id="stateData"></div>

  <script type="text/javascript">
    // Connexion à ROS via rosbridge
    var ros = new ROSLIB.Ros({
      url : 'ws://localhost:9090'
    });

    ros.on('connection', function() {
      console.log('Connecté au serveur websocket ROS.');
    });

    ros.on('error', function(error) {
      console.log('Erreur de connexion au serveur websocket ROS: ', error);
    });

    ros.on('close', function() {
      console.log('Connexion au serveur websocket ROS fermée.');
    });

    // Fonction pour choisir le mode
    function selectMode(mode) {
      var modePublisher = new ROSLIB.Topic({
        ros: ros,
        name: '/mode_command',
        messageType: 'std_msgs/String'
      });

      var modeMsg = new ROSLIB.Message({
        data: mode
      });

      modePublisher.publish(modeMsg);
      console.log('Commande envoyée: ' + mode);
    }

    // Souscription au topic "state"
    var stateListener = new ROSLIB.Topic({
        ros: ros,
        name: '/state',
        messageType: 'interfaces/msg/State'
    });

    stateListener.subscribe(function (message) {
        var stateData = 'Current State: ' + message.current_state +
                        '<br>State Name: ' + message.state_name +
                        '<br>Obstacle Detection: ' + message.obstacle_detect;

        document.getElementById('stateData').innerHTML = 'Data from "state" topic:<br>' + stateData;
    });

  </script>
</body>
</html>
